generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id                         Int                         @id @default(autoincrement())
  name                       String
  email                      String                      @unique
  phoneNo                    String?
  password                   String
  role                       UserRole                    @default(USER)
  address                    UserAddress?
  restaurants                Restaurant[]
  orders                     Order[] 
  createdAt                  DateTime                    @default(now())
  updatedAt                  DateTime                    @updatedAt
  foodRatingAndReviews       FoodRatingAndReview[]
  restaurantRatingAndReviews RestaurantRatingAndReview[]
}

model UserAddress {
  id        Int      @id @default(autoincrement())
  street    String
  city      String
  state     String
  country   String
  zipcode   String
  userId    Int      @unique
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}

model Restaurant {
  id                        Int                         @id @default(autoincrement())
  restaurantName            String
  about                     String?
  address                   RestaurantAddress?
  phoneNo                   String
  imageUrl                  String?
  food                      Food[] 
  userId                    Int
  user                      User                        @relation(fields: [userId], references: [id])
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  restaurantRatingAndReview RestaurantRatingAndReview[]
  orders                    Order[]
}

model RestaurantAddress {
  id           Int        @id @default(autoincrement())
  street       String
  city         String
  state        String
  country      String
  zipcode      String
  restaurantId Int        @unique
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])
  createdAt    DateTime   @default(now())
}

model Food {
  id            Int                   @id @default(autoincrement())
  foodName      String
  description   String?
  price         Decimal 
  discountPrice Decimal?
  imageUrl      String?
  foodRating    FoodRatingAndReview[] 
  restaurantId  Int
  restaurant    Restaurant            @relation(fields: [restaurantId], references: [id])
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  orderItems    OrderItem[]

  @@index([restaurantId])
}

model FoodRatingAndReview {
  id        Int      @id @default(autoincrement())
  rating    Int
  review    String?
  userId    Int
  foodId    Int
  food      Food     @relation(fields: [foodId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())

  @@index([foodId])
}

model RestaurantRatingAndReview {
  id           Int        @id @default(autoincrement())
  rating       Int
  review       String?
  userId       Int
  restaurantId Int
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id])
  user         User       @relation(fields: [userId], references: [id])
  createdAt    DateTime   @default(now())

  @@index([restaurantId])
}

/**
 * Orders: using Order + OrderItem for N-to-N between Order and Food
 */
model Order {
  id            Int      @id @default(autoincrement())
  userId        Int
  restaurantId  Int
  status        String   @default("PENDING") 
  totalAmount   Decimal
  paymentMethod String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user       User        @relation(fields: [userId], references: [id])
  restaurant Restaurant  @relation(fields: [restaurantId], references: [id])
  items      OrderItem[]
}

model OrderItem {
  id       Int     @id @default(autoincrement())
  orderId  Int
  foodId   Int
  quantity Int     @default(1)
  price    Decimal 
  order    Order   @relation(fields: [orderId], references: [id])
  food     Food    @relation(fields: [foodId], references: [id])
}

enum UserRole {
  USER
  RESTAURANT
  ADMIN
}

enum OrderStatus {
  PENDING
  ACCEPTED
  PREPARING
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}